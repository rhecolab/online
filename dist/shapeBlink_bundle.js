var shapeBlinkTask;(()=>{"use strict";function t(t,e,n,o,l,a){if(l<3)return;const s=2*Math.PI/l;t.beginPath();for(let a=0;a<l;a++){const l=e+o*Math.cos(a*s),i=n+o*Math.sin(a*s);0===a?t.moveTo(l,i):t.lineTo(l,i)}t.closePath(),t.fillStyle=a,t.fill()}function e(t,e,n,o,l,a="up"){let s,i;switch(a.toLowerCase()){case"up":s=Math.PI,i=2*Math.PI;break;case"down":s=0,i=Math.PI;break;case"left":s=.5*Math.PI,i=1.5*Math.PI;break;case"right":s=-.5*Math.PI,i=.5*Math.PI}t.beginPath(),t.arc(e,n,o,s,i),t.closePath(),t.fillStyle=l,t.fill()}new(window.AudioContext||window.webkitAudioContext);let n,o=0,l=[],a=null,s=0,i=0,c=[],r="";function h(o){a=o;let l=0;s=NaN;const i=o.stimOrder;function c(){if(l<i.length){const o=i[l];console.log(o),function(o){let l;console.log(o.stim,o.type),l="t1"===o.type?"white":"black",function(n,o,l,a,s){switch(n){case"star":!function(t,e,n,o,l,a,s){if(!t)return;let i=Math.PI/2*3,c=Math.PI/5;t.beginPath(),t.moveTo(e,n-l);for(let o=0;o<5;o++)t.lineTo(e+Math.cos(i)*l,n+Math.sin(i)*l),i+=c,t.lineTo(e+18.75*Math.cos(i),n+18.75*Math.sin(i)),i+=c;t.lineTo(e,n-l),t.closePath(),t.fillStyle=s,t.fill()}(o,l,a,0,37.5,0,s);break;case"circle":!function(t,e,n,o,l){t&&(t.beginPath(),t.arc(e,n,37.5,0,2*Math.PI),t.fillStyle=l,t.fill(),t.closePath())}(o,l,a,0,s);break;case"square":!function(t,e,n,o,l){t&&(t.fillStyle=l,t.fillRect(e,n,75,75))}(o,l-37.5,a-37.5,0,s);break;case"triangle":!function(t,e,n,o,l){if(!t)return;const a=Math.sqrt(3)/2*75;t.beginPath(),t.moveTo(e,n),t.lineTo(e+75,n),t.lineTo(e+37.5,n-a),t.closePath(),t.fillStyle=l,t.fill()}(o,l-37.5,a+37.5,0,s);break;case"hexagon":t(o,l,a,37.5,6,s);break;case"pentagon":t(o,l,a,37.5,5,s);break;case"octagon":t(o,l,a,37.5,8,s);break;case"semiup":e(o,l,a,37.5,s,"up");break;case"semidown":e(o,l,a,37.5,s,"down");break;case"semileft":e(o,l,a,37.5,s,"left");break;case"semiright":e(o,l,a,37.5,s,"right")}}(o.stim,n,n.canvas.width/2,n.canvas.height/2,l)}(o),l++,setTimeout(r,150)}else collectResp(1,o)}function r(){n.clearRect(0,0,n.canvas.width,n.canvas.height),setTimeout(c,50)}c()}window.onload=()=>{const t=document.getElementById("shapes");n=t.getContext("2d"),r=prompt("Enter subject number:")||Math.floor(100+900*Math.random());const e=function(t,e,n){let o=[];for(let l=0;l<n.length;l++)for(let a=0;a<t.length;a++)for(let s=0;s<e.length;s++)for(let i=0;i<2;i++)o.push({t1:t[a],t2:e[s],lag:n[l]});for(let t=o.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[o[t],o[e]]=[o[e],o[t]]}return o}(["circle","square","triangle","pentagon"],["semiup","semidown","semileft","semiright"],[0,3,9]);c=function(t){let e=[],n=[];e=["circle","square","triangle","pentagon"];for(let o=0;o<t.length;o++){let l=[];const{t1:a,t2:s,lag:i}=t[o],c=Math.floor(5*Math.random())+1;for(let t=0;t<c;t++){const t=e[Math.floor(Math.random()*e.length)];l.push({stim:t,type:"d"})}l.push({stim:a,type:"t1"});for(let t=0;t<i;t++){const t=e[Math.floor(Math.random()*e.length)];l.push({stim:t,type:"d"})}l.push({stim:s,type:"t2"});for(let t=0;t<3;t++){const t=e[Math.floor(Math.random()*e.length)];l.push({stim:t,type:"d"})}n.push({trialNum:o,t1:a,t2:s,lag:i,stimOrder:l})}return n}(e),window.trials=e,i=window.trials.length,console.log(i),document.getElementById("startButton").addEventListener("click",()=>{document.getElementById("instrBox").style.display="none",document.getElementById("startButton").style.display="none",h(c[o])})},window.collectResp=function(t,e=null){const n=trials[o];console.log("t1",n.t1),console.log("t2",n.t2),console.log("lag",n.lag),1===t&&(s={t1_item:n.t1,t2_item:n.t2,lag:n.lag,resp1:"",resp2:""}),2===t&&null!==e&&(s.resp1=e),3===t&&null!==e&&(s.resp2=e),1===t&&($("#q1").show(),$("#q2").hide()),2===t&&($("#q1").hide(),$("#q2").show()),3===t&&(l.push(s),s=null,$("#q1, #q2").hide(),o++,o<i?h(c[o]):function(t){document.getElementById("exptBox").innerText="Task complete!",console.log("Subject ID:",t),console.log("Data:",l),function(t,e,n){const o=(new Date).toISOString().split("T")[0].replace(/-/g,""),l=`${t}_${e}_${o}`,a=Object.keys(n[0]);let s="sub,"+a.join(",")+",taskName\n";n.forEach(n=>{const o=a.map(t=>n[t]??"");s+=`${t},${o.join(",")},${e}\n`}),fetch("/save-results",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file:l,csv:s})}).then(t=>t.text()).then(t=>console.log("saved",t)).catch(t=>console.error("error:",t))}(t,"shapeBlink",l)}(r))},shapeBlinkTask={}})();