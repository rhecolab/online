import{randomizeFull,makeSeq}from"../../funcs/randomization.js";import{saveData}from"../../funcs/saveData.js";import{preloadSounds,playSound,buffer,audioCtx}from"../../funcs/utils.js";import html from"./audBlink.html";import"../../funcs/blink.css";window.playSound=playSound,window.preloadSounds=preloadSounds;const stimON=300,stimOFF=300;let trialNum=0,data=[],currentTrial=null,currentTrialRow=0,trialTotal=0,fullSeq=[],sounds={},subjID="";const taskName="audBlink";async function startTask(t){subjID=t;const e=document.createElement("div");e.id="expRoot",document.querySelector(".SkinInner").appendChild(e),e.innerHTML=html;const l=randomizeFull(["glide_up","glide_down"],["a1_sh","a2_sh","a8_sh","a9_sh"],[0,3,9],2);fullSeq=makeSeq(l,"aud"),window.trials=l,trialTotal=window.trials.length,await preloadSounds(["glide_up","glide_down","a1_sh","a2_sh","a8_sh","a9_sh","h1_sh","h2_sh","h3_sh","h4_sh","h5_sh","h6_sh","h7_sh","h8_sh","h9_sh","h10_sh","i1_sh","i2_sh","i3_sh","i4_sh","i5_sh","i6_sh","i7_sh","i8_sh","i9_sh","i10_sh"]),document.getElementById("startButton").addEventListener("click",()=>{document.getElementById("instrBox").style.display="none",document.getElementById("startButton").style.display="none",runTrial(fullSeq[trialNum])})}export default{startTask};function runTrial(t){currentTrial=t,currentTrialRow=NaN;const e=t.stimOrder;let l=audioCtx.currentTime;for(let t=0;t<e.length;t++){const n=e[t];playSound(n.stim,l),scheduleFixOn(l),scheduleFixOff(l+.3),l+=.6}const n=600*e.length;setTimeout(()=>collectResp(1,t),n)}function scheduleFixOn(t){const e=1e3*(t-audioCtx.currentTime);setTimeout(()=>{$("#fix").text("+")},e)}function scheduleFixOff(t){const e=1e3*(t-audioCtx.currentTime);setTimeout(()=>{$("#fix").text("")},e)}function endTask(){console.log("Task complete."),console.log("Data:",data);const t=JSON.stringify(data);Qualtrics.SurveyEngine.setEmbeddedData("audBlinkData",t),document.querySelector("#NextButton").click()}window.collectResp=function(t,e=null){const l=trials[trialNum];console.log("t1",l.t1),console.log("t2",l.t2),console.log("lag",l.lag);const n=document.getElementById("q1"),s=document.getElementById("q2");1===t&&(new Date,currentTrialRow={t1_item:l.t1,t2_item:l.t2,lag:l.lag,resp1:"",resp2:""}),2===t&&null!==e&&(currentTrialRow.resp1=e),3===t&&null!==e&&(currentTrialRow.resp2=e),1===t&&(n&&(n.style.display="block"),s&&(s.style.display="none")),2===t&&(n&&(n.style.display="none"),s&&(s.style.display="block")),3===t&&(data.push(currentTrialRow),currentTrialRow=null,n&&(n.style.display="none"),s&&(s.style.display="none"),trialNum++,trialNum<trialTotal?runTrial(fullSeq[trialNum]):endTask(subjID,taskName))};