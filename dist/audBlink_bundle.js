var audBlinkTask;(()=>{"use strict";const t=new(window.AudioContext||window.webkitAudioContext),e={};async function s(s){for(const o of s){const s=`../../stimuli/snds/${o}.wav`,n=await fetch(s),h=await n.arrayBuffer();e[o]=await t.decodeAudioData(h)}console.log("sounds preloaded")}function o(s,o,n=!1){!0===n?$("#fix").text(""):$("#fix").text("+");const h=t.createBufferSource();h.buffer=e[s],h.connect(t.destination),h.start(o)}window.playSound=o,window.preloadSounds=s;let n=0,h=[],l=null,i=0,a=0,r=[],c={},d="";function u(e){l=e,i=NaN;const s=e.stimOrder;let n=t.currentTime;for(let t=0;t<s.length;t++)o(s[t].stim,n),_(n),f(n+.3),n+=.6;const h=600*s.length;setTimeout(()=>collectResp(1,e),h)}function _(e){const s=1e3*(e-t.currentTime);setTimeout(()=>{$("#fix").text("+")},s)}function f(e){const s=1e3*(e-t.currentTime);setTimeout(()=>{$("#fix").text("")},s)}window.onload=async()=>{d=prompt("Enter subject number:")||Math.floor(100+900*Math.random());const t=function(t,e,s){let o=[];for(let n=0;n<s.length;n++)for(let h=0;h<t.length;h++)for(let l=0;l<e.length;l++)for(let i=0;i<2;i++)o.push({t1:t[h],t2:e[l],lag:s[n]});for(let t=o.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[o[t],o[e]]=[o[e],o[t]]}return o}(["glide_up","glide_down"],["a1_sh","a2_sh","a8_sh","a9_sh"],[0,3,9]);r=function(t){let e=[],s=[];e=["h1_sh","h2_sh","h3_sh","h4_sh","h5_sh","h6_sh","h7_sh","h8_sh","h9_sh","h10_sh","i1_sh","i2_sh","i3_sh","i4_sh","i5_sh","i6_sh","i7_sh","i8_sh","i9_sh","i10_sh"];for(let o=0;o<t.length;o++){let n=[];const{t1:h,t2:l,lag:i}=t[o],a=Math.floor(5*Math.random())+1;for(let t=0;t<a;t++){const t=e[Math.floor(Math.random()*e.length)];n.push({stim:t,type:"d"})}n.push({stim:h,type:"t1"});for(let t=0;t<i;t++){const t=e[Math.floor(Math.random()*e.length)];n.push({stim:t,type:"d"})}n.push({stim:l,type:"t2"});for(let t=0;t<3;t++){const t=e[Math.floor(Math.random()*e.length)];n.push({stim:t,type:"d"})}s.push({trialNum:o,t1:h,t2:l,lag:i,stimOrder:n})}return s}(t),window.trials=t,a=window.trials.length,console.log(a),c=await s(["glide_up","glide_down","a1_sh","a2_sh","a8_sh","a9_sh","h1_sh","h2_sh","h3_sh","h4_sh","h5_sh","h6_sh","h7_sh","h8_sh","h9_sh","h10_sh","i1_sh","i2_sh","i3_sh","i4_sh","i5_sh","i6_sh","i7_sh","i8_sh","i9_sh","i10_sh"]),document.getElementById("startButton").addEventListener("click",()=>{document.getElementById("instrBox").style.display="none",document.getElementById("startButton").style.display="none",u(r[n])})},window.collectResp=function(t,e=null){const s=trials[n];console.log("t1",s.t1),console.log("t2",s.t2),console.log("lag",s.lag),1===t&&(new Date,i={t1_item:s.t1,t2_item:s.t2,lag:s.lag,resp1:"",resp2:""}),2===t&&null!==e&&(i.resp1=e),3===t&&null!==e&&(i.resp2=e),1===t&&($("#q1").show(),$("#q2").hide()),2===t&&($("#q1").hide(),$("#q2").show()),3===t&&(h.push(i),i=null,$("#q1, #q2").hide(),n++,n<a?u(r[n]):function(t){document.getElementById("exptBox").innerText="Task complete!",console.log("Subject ID:",t),console.log("Data:",h),function(t,e,s){const o=(new Date).toISOString().split("T")[0].replace(/-/g,""),n=`${t}_${e}_${o}`,h=Object.keys(s[0]);let l="sub,"+h.join(",")+",taskName\n";s.forEach(s=>{const o=h.map(t=>s[t]??"");l+=`${t},${o.join(",")},${e}\n`}),fetch("/save-results",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file:n,csv:l})}).then(t=>t.text()).then(t=>console.log("saved",t)).catch(t=>console.error("error:",t))}(t,"audBlink",h)}(d))},audBlinkTask={}})();